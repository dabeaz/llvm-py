
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Functions</title>
    
    <meta name="author" content="">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/stylesheets/pygment_trac.css" rel="stylesheet" type="text/css">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">llvm-py Documentation</a>
          <ul class="nav">
            
            
            


  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>Functions </h1>
</div>

<div class="row">
  <div class="span12">
    <p>Functions are represented by <a href='llvm.core.Function.html'>llvm.core.Function</a> objects. They are contained within modules, and can be created either with the method <code>module_obj.add_function</code> or the static constructor <code>Function.new</code>. References to functions already present in a module can be retrieved via <code>module.get_function_named</code> or by the static constructor method <code>Function.get</code>. All functions in a module can be enumerated by iterating over <code>module_obj.functions</code>.</p>
<div class='highlight'><pre><code class='python'><span class='c'># create a type, representing functions that take an integer and return</span>
<span class='c'># a floating point value.</span>
<span class='n'>ft</span> <span class='o'>=</span> <span class='n'>Type</span><span class='o'>.</span><span class='n'>function</span><span class='p'>(</span> <span class='n'>Type</span><span class='o'>.</span><span class='n'>float</span><span class='p'>(),</span> <span class='p'>[</span> <span class='n'>Type</span><span class='o'>.</span><span class='n'>int</span><span class='p'>()</span> <span class='p'>]</span> <span class='p'>)</span>

<span class='c'># create a function of this type</span>
<span class='n'>f1</span> <span class='o'>=</span> <span class='n'>module_obj</span><span class='o'>.</span><span class='n'>add_function</span><span class='p'>(</span><span class='n'>ft</span><span class='p'>,</span> <span class='s'>&quot;func1&quot;</span><span class='p'>)</span>

<span class='c'># or equivalently, like this:</span>
<span class='n'>f2</span> <span class='o'>=</span> <span class='n'>Function</span><span class='o'>.</span><span class='n'>new</span><span class='p'>(</span><span class='n'>module_obj</span><span class='p'>,</span> <span class='n'>ft</span><span class='p'>,</span> <span class='s'>&quot;func2&quot;</span><span class='p'>)</span>

<span class='c'># get a reference to an existing function</span>
<span class='n'>f3</span> <span class='o'>=</span> <span class='n'>module_obj</span><span class='o'>.</span><span class='n'>get_function_named</span><span class='p'>(</span><span class='s'>&quot;func3&quot;</span><span class='p'>)</span>

<span class='c'># or like this:</span>
<span class='n'>f4</span> <span class='o'>=</span> <span class='n'>Function</span><span class='o'>.</span><span class='n'>get</span><span class='p'>(</span><span class='n'>module_obj</span><span class='p'>,</span> <span class='s'>&quot;func4&quot;</span><span class='p'>)</span>

<span class='c'># list all function names in a module</span>
<span class='k'>for</span> <span class='n'>f</span> <span class='ow'>in</span> <span class='n'>module_obj</span><span class='o'>.</span><span class='n'>functions</span><span class='p'>:</span>
    <span class='k'>print</span> <span class='n'>f</span><span class='o'>.</span><span class='n'>name</span>
</code></pre>
</div>
<h1 id='intrinsic'>Intrinsic</h1>

<p>References to intrinsic functions can be got via the static constructor <code>intrinsic</code>. This returns a <code>Function</code> object, calling which is equivalent to invoking the intrinsic. The <code>intrinsic</code> method has to be called with a module object, an instrinic ID (which is a numeric constant) and a list of the types of arguments (which LLVM uses to resolve overloaded intrinsic functions).</p>
<div class='highlight'><pre><code class='python'><span class='c'># get a reference to the llvm.bswap intrinsic</span>
<span class='n'>bswap</span> <span class='o'>=</span> <span class='n'>Function</span><span class='o'>.</span><span class='n'>intrinsic</span><span class='p'>(</span><span class='n'>mod</span><span class='p'>,</span> <span class='n'>INTR_BSWAP</span><span class='p'>,</span> <span class='p'>[</span><span class='n'>Type</span><span class='o'>.</span><span class='n'>int</span><span class='p'>()])</span>

<span class='c'># call it</span>
<span class='n'>builder</span><span class='o'>.</span><span class='n'>call</span><span class='p'>(</span><span class='n'>bswap</span><span class='p'>,</span> <span class='p'>[</span><span class='n'>value</span><span class='p'>])</span>
</code></pre>
</div>
<p>Here, the constant <code>INTR_BSWAP</code>, available from <code>llvm.core</code>, represents the LLVM intrinsic <a href='http://www.llvm.org/docs/LangRef.html#int_bswap'>llvm.bswap</a>. The <code>[Type.int()]</code> selects the version of <code>llvm.bswap</code> that has a single 32-bit integer argument. The list of intrinsic IDs defined as integer constants in <code>llvm.core</code>. These are:</p>

<p><code>INTR_ANNOTATION</code>,<code>INTR_ATOMIC_CMP_SWAP</code>,<code>INTR_ATOMIC_LOAD_ADD</code>,<code>INTR_ATOMIC_LOAD_AND</code> <code>INTR_ATOMIC_LOAD_MAX</code>,<code>INTR_ATOMIC_LOAD_MIN</code>,<code>INTR_ATOMIC_LOAD_NAND</code>,<code>INTR_ATOMIC_LOAD_OR</code> <code>INTR_ATOMIC_LOAD_SUB</code>,<code>INTR_ATOMIC_LOAD_UMAX</code>,<code>INTR_ATOMIC_LOAD_UMIN</code>,<code>INTR_ATOMIC_LOAD_XOR</code> <code>INTR_ATOMIC_SWAP</code>,<code>INTR_BSWAP</code>,<code>INTR_CONVERTFF</code>,<code>INTR_CONVERTFSI</code> <code>INTR_CONVERTFUI</code>,<code>INTR_CONVERTSIF</code>,<code>INTR_CONVERTSS</code>,<code>INTR_CONVERTSU</code> <code>INTR_CONVERTUIF</code>,<code>INTR_CONVERTUS</code>,<code>INTR_CONVERTUU</code>,<code>INTR_COS</code> <code>INTR_CTLZ</code>,<code>INTR_CTPOP</code>,<code>INTR_CTTZ</code>,<code>INTR_DBG_DECLARE</code> <code>INTR_DBG_VALUE</code>,<code>INTR_EH_DWARF_CFA</code>,<code>INTR_EH_EXCEPTION</code>,<code>INTR_EH_RETURN_I32</code> <code>INTR_EH_RETURN_I64</code>,<code>INTR_EH_SELECTOR</code>,<code>INTR_EH_SJLJ_CALLSITE</code>,<code>INTR_EH_SJLJ_LONGJMP</code> <code>INTR_EH_SJLJ_LSDA</code>,<code>INTR_EH_SJLJ_SETJMP</code>,<code>INTR_EH_TYPEID_FOR</code>,<code>INTR_EH_UNWIND_INIT</code> <code>INTR_EXP</code>,<code>INTR_EXP2</code>,<code>INTR_FLT_ROUNDS</code>,<code>INTR_FRAMEADDRESS</code> <code>INTR_GCREAD</code>,<code>INTR_GCROOT</code>,<code>INTR_GCWRITE</code>,<code>INTR_INIT_TRAMPOLINE</code> <code>INTR_INVARIANT_END</code>,<code>INTR_INVARIANT_START</code>,<code>INTR_LIFETIME_END</code>,<code>INTR_LIFETIME_START</code> <code>INTR_LOG</code>,<code>INTR_LOG10</code>,<code>INTR_LOG2</code>,<code>INTR_LONGJMP</code> <code>INTR_MEMCPY</code>,<code>INTR_MEMMOVE</code>,<code>INTR_MEMORY_BARRIER</code>,<code>INTR_MEMSET</code> <code>INTR_OBJECTSIZE</code>,<code>INTR_PCMARKER</code>,<code>INTR_POW</code>,<code>INTR_POWI</code> <code>INTR_PREFETCH</code>,<code>INTR_PTR_ANNOTATION</code>,<code>INTR_READCYCLECOUNTER</code>,<code>INTR_RETURNADDRESS</code> <code>INTR_SADD_WITH_OVERFLOW</code>,<code>INTR_SETJMP</code>,<code>INTR_SIGLONGJMP</code>,<code>INTR_SIGSETJMP</code> <code>INTR_SIN</code>,<code>INTR_SMUL_WITH_OVERFLOW</code>,<code>INTR_SQRT</code>,<code>INTR_SSUB_WITH_OVERFLOW</code> <code>INTR_STACKPROTECTOR</code>,<code>INTR_STACKRESTORE</code>,<code>INTR_STACKSAVE</code>,<code>INTR_TRAP</code> <code>INTR_UADD_WITH_OVERFLOW</code>,<code>INTR_UMUL_WITH_OVERFLOW</code>,<code>INTR_USUB_WITH_OVERFLOW</code>,<code>INTR_VACOPY</code> <code>INTR_VAEND</code>,<code>INTR_VAR_ANNOTATION</code>,<code>INTR_VASTART</code></p>

<p>There are also target-specific intrinsics (which correspond to that target&#8217;s CPU instructions) available, but are omitted here for brevity. Full list can be seen from <a href='https://github.com/numba/llvm-py/blob/master/llvm/_intrinsic_ids.py'><em>intrinsic</em>ids.py</a>. See the <a href='http://www.llvm.org/docs/LangRef.html'>LLVM Language Reference</a> for more information on the intrinsics, and the <a href='https://github.com/numba/llvm-py/blob/master/test/intrinsic.py'>test</a> directory in the source distribution for more examples. The intrinsic ID can be retrieved from a function object with the read-only property <code>intrinsic_id</code>.</p>

<blockquote>
<p><strong>Auto-generation of Intrinsic IDs</strong></p>

<p>A script (tool/intrgen.py in source tree) generates the intrinsic IDs automatically. This is necessary when compiling llvm-py with a different version of LLVM.</p>
</blockquote>

<h1 id='callconv'>Calling Convention</h1>

<p>The function&#8217;s calling convention can be set using the <code>calling_convention</code> property. The following (integer) constants defined in <code>llvm.core</code> can be used as values:</p>
<table><thead><tr><th>Value</th><th>Equivalent LLVM Assembly Keyword</th></tr></thead><tbody><tr><td style='text-align: left;'><code>CC_C</code></td><td style='text-align: left;'><code>ccc</code></td>
</tr><tr><td style='text-align: left;'><code>CC_FASTCALL</code></td><td style='text-align: left;'><code>fastcc</code></td>
</tr><tr><td style='text-align: left;'><code>CC_COLDCALL</code></td><td style='text-align: left;'><code>coldcc</code></td>
</tr><tr><td style='text-align: left;'><code>CC_X86_STDCALL</code></td><td style='text-align: left;'><code>x86_stdcallcc</code></td>
</tr><tr><td style='text-align: left;'><code>CC_X86_FASTCALL</code></td><td style='text-align: left;'><code>x86_fastcallcc</code></td>
</tr></tbody></table>
<p>See the <a href='http://www.llvm.org/docs/LangRef.html#callingconv'>LLVM docs</a> for more information on each. Backend-specific numbered conventions can be directly passed as integers.</p>

<p>An arbitrary string identifying which garbage collector to use can be set or got with the property <code>collector</code>.</p>

<p>The value objects corresponding to the arguments of a function can be got using the read-only property <code>args</code>. These can be iterated over, and also be indexed via integers. An example:</p>
<div class='highlight'><pre><code class='python'><span class='c'># list all argument names and types</span>
<span class='k'>for</span> <span class='n'>arg</span> <span class='ow'>in</span> <span class='n'>fn</span><span class='o'>.</span><span class='n'>args</span><span class='p'>:</span>
    <span class='k'>print</span> <span class='n'>arg</span><span class='o'>.</span><span class='n'>name</span><span class='p'>,</span> <span class='s'>&quot;of type&quot;</span><span class='p'>,</span> <span class='n'>arg</span><span class='o'>.</span><span class='n'>type</span>

<span class='c'># change the name of the first argument</span>
<span class='n'>fn</span><span class='o'>.</span><span class='n'>args</span><span class='p'>[</span><span class='mi'>0</span><span class='p'>]</span><span class='o'>.</span><span class='n'>name</span> <span class='o'>=</span> <span class='s'>&quot;objptr&quot;</span>
</code></pre>
</div>
<p>Basic blocks (see later) are contained within functions. When newly created, a function has no basic blocks. They have to be added explicitly, using the <code>append_basic_block</code> method, which adds a new, empty basic block as the last one in the function. The first basic block of the function can be retrieved using the <code>get_entry_basic_block</code> method. The existing basic blocks can be enumerated by iterating over using the read-only property <code>basic_blocks</code>. The number of basic blocks can be got via <code>basic_block_count</code> method. Note that <code>get_entry_basic_block</code> is slightly faster than <code>basic_blocks[0]</code> and so is <code>basic_block_count</code>, over <code>len(f.basic_blocks)</code>.</p>
<div class='highlight'><pre><code class='python'><span class='c'># add a basic block</span>
<span class='n'>b1</span> <span class='o'>=</span> <span class='n'>fn</span><span class='o'>.</span><span class='n'>append_basic_block</span><span class='p'>(</span><span class='s'>&quot;entry&quot;</span><span class='p'>)</span>

<span class='c'># get the first one</span>
<span class='n'>b2</span> <span class='o'>=</span> <span class='n'>fn</span><span class='o'>.</span><span class='n'>get_entry_basic_block</span><span class='p'>()</span>
<span class='n'>b2</span> <span class='o'>=</span> <span class='n'>fn</span><span class='o'>.</span><span class='n'>basic_mdblocks</span><span class='p'>[</span><span class='mi'>0</span><span class='p'>]</span>  <span class='c'># slower than previous method</span>

<span class='c'># print names of all basic blocks</span>
<span class='k'>for</span> <span class='n'>b</span> <span class='ow'>in</span> <span class='n'>fn</span><span class='o'>.</span><span class='n'>basic_blocks</span><span class='p'>:</span>
    <span class='k'>print</span> <span class='n'>b</span><span class='o'>.</span><span class='n'>name</span>

<span class='c'># get number of basic blocks</span>
<span class='n'>n</span> <span class='o'>=</span> <span class='n'>fn</span><span class='o'>.</span><span class='n'>basic_block_count</span>
<span class='n'>n</span> <span class='o'>=</span> <span class='nb'>len</span><span class='p'>(</span><span class='n'>fn</span><span class='o'>.</span><span class='n'>basic_blocks</span><span class='p'>)</span>  <span class='c'># slower than previous method</span>
</code></pre>
</div>
<p>Functions can be deleted using the method <code>delete</code>. This deletes them from their containing module. All references to the function object should be dropped after <code>delete</code> has been called.</p>

<p>Functions can be verified with the <code>verify</code> method. Note that this may not work properly (aborts on errors).</p>

<h1 id='fnattr'>Function Attributes</h1>

<p>Function attributes, as documented <a href='http://www.llvm.org/docs/LangRef.html#fnattrs'>here</a>, can be set on functions using the methods <code>add_attribute</code> and <code>remove_attribute</code>. The following values may be used to refer to the LLVM attributes:</p>
<table><thead><tr><th>Value</th><th>Equivalent LLVM Assembly Keyword</th></tr></thead><tbody><tr><td style='text-align: left;'><code>ATTR_ALWAYS_INLINE</code></td><td style='text-align: left;'><code>alwaysinline</code></td>
</tr><tr><td style='text-align: left;'><code>ATTR_INLINE_HINT</code></td><td style='text-align: left;'><code>inlinehint</code></td>
</tr><tr><td style='text-align: left;'><code>ATTR_NO_INLINE</code></td><td style='text-align: left;'><code>noinline</code></td>
</tr><tr><td style='text-align: left;'><code>ATTR_OPTIMIZE_FOR_SIZE</code></td><td style='text-align: left;'><code>optsize</code></td>
</tr><tr><td style='text-align: left;'><code>ATTR_NO_RETURN</code></td><td style='text-align: left;'><code>noreturn</code></td>
</tr><tr><td style='text-align: left;'><code>ATTR_NO_UNWIND</code></td><td style='text-align: left;'><code>nounwind</code></td>
</tr><tr><td style='text-align: left;'><code>ATTR_READ_NONE</code></td><td style='text-align: left;'><code>readnone</code></td>
</tr><tr><td style='text-align: left;'><code>ATTR_READONLY</code></td><td style='text-align: left;'><code>readonly</code></td>
</tr><tr><td style='text-align: left;'><code>ATTR_STACK_PROTECT</code></td><td style='text-align: left;'><code>ssp</code></td>
</tr><tr><td style='text-align: left;'><code>ATTR_STACK_PROTECT_REQ</code></td><td style='text-align: left;'><code>sspreq</code></td>
</tr><tr><td style='text-align: left;'><code>ATTR_NO_REDZONE</code></td><td style='text-align: left;'><code>noredzone</code></td>
</tr><tr><td style='text-align: left;'><code>ATTR_NO_IMPLICIT_FLOAT</code></td><td style='text-align: left;'><code>noimplicitfloat</code></td>
</tr><tr><td style='text-align: left;'><code>ATTR_NAKED</code></td><td style='text-align: left;'><code>naked</code></td>
</tr></tbody></table>
<p>Here is how attributes can be set and removed:</p>
<div class='highlight'><pre><code class='python'><span class='c'># create a function</span>
<span class='n'>ti</span> <span class='o'>=</span> <span class='n'>Type</span><span class='o'>.</span><span class='n'>int</span><span class='p'>(</span><span class='mi'>32</span><span class='p'>)</span>
<span class='n'>tf</span> <span class='o'>=</span> <span class='n'>Type</span><span class='o'>.</span><span class='n'>function</span><span class='p'>(</span><span class='n'>ti</span><span class='p'>,</span> <span class='p'>[</span><span class='n'>ti</span><span class='p'>,</span> <span class='n'>ti</span><span class='p'>])</span>
<span class='n'>m</span> <span class='o'>=</span> <span class='n'>Module</span><span class='o'>.</span><span class='n'>new</span><span class='p'>(</span><span class='s'>&#39;mod&#39;</span><span class='p'>)</span>
<span class='n'>f</span> <span class='o'>=</span> <span class='n'>m</span><span class='o'>.</span><span class='n'>add_function</span><span class='p'>(</span><span class='n'>tf</span><span class='p'>,</span> <span class='s'>&#39;sum&#39;</span><span class='p'>)</span>
<span class='k'>print</span> <span class='n'>f</span>
<span class='c'>#   declare i32 @sum(i32, i32)</span>

<span class='c'># add a couple of attributes</span>
<span class='n'>f</span><span class='o'>.</span><span class='n'>add_attribute</span><span class='p'>(</span><span class='n'>ATTR_NO_UNWIND</span><span class='p'>)</span>
<span class='n'>f</span><span class='o'>.</span><span class='n'>add_attribute</span><span class='p'>(</span><span class='n'>ATTR_READONLY</span><span class='p'>)</span>
<span class='k'>print</span> <span class='n'>f</span>
<span class='c'>#   declare i32 @sum(i32, i32) nounwind readonly</span>
</code></pre>
</div>
<p><strong>Related Links</strong></p>

<p><a href='llvm.core.Function.html'>llvm.core.Function</a>, <a href='llvm.core.Argument.html'>llvm.core.Argument</a></p>
  </div>
</div>


      </div>

      <footer>
        <p>&copy;  2012
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
  </body>
</html>

